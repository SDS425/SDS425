---
title: "R Notebook"
html_notebook: default
---

```{r setup}
library(glmnet)
library(corrplot)
library(broom)
library(ggplot2)
library(sf)
library(MASS)
library(collapse)
library(data.table)

set.seed(425)
knitr::opts_chunk$set(cache.extra = .Random.seed)
knitr::opts_chunk$set(root.dir = "./2023S_SDS425/Project1_EV_Charging/data_collection")

setDTthreads(threads = 0); threads = getDTthreads()
data = fread("merged_data.csv")

# sample_size = 1e4
# data_sample = data[sample.int(n = .N, size = sample_size)]
```

```{r}
data |> purrr::map_int(purrr::compose(sum, is.na)) |> sort() |> rev()
```



```{r}
#adding comment
data

#histogram

hist(data$EV.Level2.EVSE.Num, breaks = 100, main ="Histogram of Level 2 Chargers")
hist(data$EV.DC.Fast.Count, breaks = 100, main ="Histogram of Level 3 DCFC Chargers")
hist(data$N.Stations, breaks = 100, main ="Histogram of total Chargers")

y <- data$N.Stations
          
x <- data.matrix(data[, -c("EV.Level1.EVSE.Num", "EV.Level2.EVSE.Num", "EV.DC.Fast.Count", "N.Stations")])

library(glmnet)

#perform k-fold cross-validation to find optimal lambda value
cv_model <- cv.glmnet(x, y, alpha = 1)

#find optimal lambda value that minimizes test MSE
best_lambda <- cv_model$lambda.min
best_lambda
plot(cv_model)

best_model <- glmnet(x, y, alpha = 1, lambda = best_lambda)
coef(best_model)

```

```{r}
pairs(data_sample[, c("N_Stations", "2016_dem_proportion", "Colleges, Universities, and Professional Schools", "Other Financial Investment Activities", "miles")])

```


```{r}
cv.glmnet(x = data[,-"GEOID"], y = data[,"GEOID"], nfolds = 15)$lambda.min
```

